---
format: html
title: ERGM models for CSS data
---

```{r}
#| label: setup
#| warning: false
#| message: false
library(sna)
library(ergm)
library(netplot)
```

```{r}
#| label: data
# Loading the data
load("data/replication1.RData")
rm(list = ls(pattern = "[^mix]$")) # Keeping only mix
```

# Hightech data

```{r}
#| label: high-summary-stats
gridExtra::grid.arrange(
  nplot(high_ad.mix, bg.col = "lightgray") ,
  nplot(high_fr.mix, vertex.color = "white", bg.col = "black"), nrow = 1
)
```

```{r}
control_mcmc <- control.ergm(
    MCMC.samplesize = 1024 * 4, # Twice the  default
    MCMC.interval = 1024 * 2, # Eight times 
    parallel = 4 # Four chains
)

# Baseline model
ans_high_ad.mix00 <- ergm(
  high_ad.mix ~ edges + mutual
)

summary(ans_high_ad.mix00)

# Model with idegree distribution
ans_high_ad.mix01 <- ergm(
  high_ad.mix ~ edges + mutual + gwidegree(0.1, fixed = TRUE),
  control = control_mcmc)

summary(ans_high_ad.mix01)
plot(gof_high_ad.mix01 <- gof(ans_high_ad.mix01))

# Model with odegree distribution
ergm_model <- high_ad.mix ~ edges + mutual + gwidegree(0.1, fixed = TRUE) + esp(1:5)
summary_formula(ergm_model)
ans_high_ad.mix02 <- ergm(ergm_model, control = control_mcmc)

summary(ans_high_ad.mix02)

# Model with odegree distribution
ans_high_ad.mix03 <- ergm(
  high_ad.mix ~ edges + mutual + gwidegree(0.2, fixed = TRUE) +
    dgwdsp(decay = 0.2, fixed = TRUE, cutoff = 10)
)

summary(ans_high_ad.mix03)
gof(ans_high_ad.mix03)

```


# Ital

```{r}
#| label: ital-summary-stats
gridExtra::grid.arrange(
  nplot(ital_ad.mix, bg.col = "lightgray") ,
  nplot(ital_fr.mix, vertex.color = "white", bg.col = "black"), nrow = 1
)
```

# paci

```{r}
#| label: paci-summary-stats
gridExtra::grid.arrange(
  nplot(paci_ad.mix, bg.col = "lightgray") ,
  nplot(paci_fr.mix, vertex.color = "white", bg.col = "black"), nrow = 1
)
```

# sili

```{r}
#| label: sili-summary-stats
gridExtra::grid.arrange(
  nplot(sili_ad.mix, bg.col = "lightgray") ,
  nplot(sili_fr.mix, vertex.color = "white", bg.col = "black"), nrow = 1
)
```

